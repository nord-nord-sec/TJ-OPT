# Certificate Attributes

Analyzing certificate attributes that are in the template: 

```
     Value                            Definition
     
pkicertificatetemplate        -->  	   Specify the templateâ€™s schema version
mspki-enrollment-flag         -->  	   Specifies enrollment flags (https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-crtd/ec71fd43-61c2-407b-83c9-b52272dec8a1)
mspki-ra-signature            -->  	   Specifies the number of enrollment registration authority signatures that are required in an enrollment request
mspki-certificate-name-flag    -->  	   Specifies the subject name flags (https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-crtd/1192823c-d839-4bc3-9b6b-fa8c53507ae1)
```

Reviewing Object Identifiers to understand how the certificates are being used: 

```
Usages (EKUs - pkiextendedkeyusage Attribute) : 

     Value                      Definition

1.3.6.1.5.5.7.3.3        -->  	Code Signing                                             
1.3.6.1.4.1.311.10.3.4   -->   	Encrypting File System                                   
1.3.6.1.5.5.7.3.4        -->   	Encrypting Mail                                          
1.3.6.1.4.1.311.20.2.2   -->   	Smart Card Logon                                         
1.3.6.1.5.5.7.3.2        -->    Authentication to another server                         
1.3.6.1.5.2.3.4          -->   	PKINIT Client Authentication (Needs to be added manually)
1.3.6.1.5.5.7.3          -->   	Server Authentication (Identifying servers)              					
2.5.29.37.0              -->    One or more purposes for which the certified public key may be used            
```

# Certificate Enrollment

## DNS Requirements:

Attributes: (CT_FLAG_SUBJECT_ALT_REQUIRE_DNS or CT_FLAG_SUBJECT_ALT_REQUIRE_DOMAIN_DNS)

- Only accounts with the `dNSHostName` attribute set can enroll.
- Active Directory users **cannot** enroll in certificate templates that require a `dNSHostName`.
- Computers get their `dNSHostName` attribute set when they are joined to a domain. However, this attribute remains empty if a computer object is simply created in Active Directory.
- Computers can add a DNS name matching their computer name since they have validated write access to their `dNSHostName` attribute.

## Email Requirements:

Attributes: (CT_FLAG_SUBJECT_ALT_REQUIRE_EMAIL or CT_FLAG_SUBJECT_REQUIRE_EMAIL)

- Only accounts with the `mail` attribute set can enroll unless the template is of schema version 1.
- By default, users and computers do not have the `mail` attribute set and cannot modify this attribute themselves.
- Users might have the `mail` attribute set, but it is uncommon for computers.

# Resources: 
- https://github.com/RayRRT/Active-Directory-Certificate-Services-abuse/blob/main/README.md#heading5

