# General Overview

ESC6 occurs when the CA sets the EDITF_ATTRIBUTESUBJECTALTNAME2 flag, which allows the enrollee to specify an arbitrary SAN on all certificates, regardless of the template's configuration. Following the patch for CVE-2022-26923, this technique no longer works in isolation and must be combined with ESC10.

The attack method is similar to ESC1, with the difference being that you can select any certificate template that supports client authentication. After the May 2022 security updates, new certificates include a security extension that embeds the requester's objectSid property. In ESC1, this property is derived from the SAN specified, but in ESC6, it reflects the requester's actual objectSid, not the SAN. The following example illustrates how the objectSid changes depending on the requester. (EDIT_ATTRIBUTESUBJECTALTNAME2)

We can use certutil to check if this setting is enabled: 

-  certutil -config "CA_HOST\CA_NAME" -getreg "policy\EditFlags"



# Abusing ESC6 Certificate Templates
## Certipy: 
- `certipy-ad req -u "afsimmons@megacorpone.com" -p "$PASSWORD" -dc-ip "$DC_IP" -target "$ADCS_HOST" -ca 'ca_name' -template 'vulnerable template' -alt 'xadmin@megacorpone.com'